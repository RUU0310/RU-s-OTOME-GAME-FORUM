# ✨ 幻想聊天功能

基于用户偏好数据生成理想形象，并通过DeepSeek API实现个性化AI对话功能。

## 🎯 功能特性

### 1. 理想形象生成
- **外貌分析**: 基于用户对角色外貌的评分，分析偏好的发色、瞳色、配饰、气质、年龄等特征
- **性格分析**: 根据用户评分偏好，生成性格特征、说话语气、世界观倾向
- **个性化展示**: 以卡片形式展示用户的理想形象

### 2. AI对话功能
- **角色扮演**: AI根据用户偏好特征，扮演理想角色进行对话
- **语气模仿**: 根据用户偏好的语气特征生成回复
- **性格一致**: 保持角色性格特征的一致性
- **实时对话**: 支持实时聊天，自动滚动显示对话记录

### 3. 数据驱动
- **评分分析**: 基于用户对游戏角色的外貌和性格评分
- **标签统计**: 分析角色标签偏好，生成个性化特征
- **动态更新**: 随着用户评分数据的变化，理想形象会相应更新

## 🚀 快速开始

### 1. 环境准备
```bash
# 进入后端目录
cd otmg-backend

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置API密钥
```bash
# Windows
set DEEPSEEK_API_KEY=your_api_key_here

# Linux/Mac
export DEEPSEEK_API_KEY=your_api_key_here
```

### 3. 启动服务
```bash
# 方式1: 使用启动脚本（推荐）
python start_fantasy_chat.py

# 方式2: 直接启动
python app.py
```

### 4. 启动前端
```bash
# 进入前端目录
cd otmg-fontend

# 安装依赖（如果还没安装）
npm install

# 启动开发服务器
npm run dev
```

## 📱 使用流程

1. **访问偏好报告页面**
   - 登录系统后，进入偏好报告页面
   - 点击"刷新报告"生成最新的偏好分析

2. **进入幻想时间**
   - 点击"进入幻想时间"按钮
   - 系统会自动加载用户的偏好数据

3. **查看理想形象**
   - 左侧展示基于用户偏好生成的理想形象
   - 包含外貌特征和性格特征

4. **开始对话**
   - 在右侧聊天区域输入消息
   - AI会根据角色设定进行回复
   - 支持连续对话，保持角色一致性

## 🛠️ 技术架构

### 前端技术栈
- **Vue 3**: 响应式框架
- **Element Plus**: UI组件库
- **Vue Router**: 路由管理
- **Axios**: HTTP客户端
- **ECharts**: 数据可视化

### 后端技术栈
- **Flask**: Web框架
- **SQLAlchemy**: ORM框架
- **DeepSeek API**: AI对话服务
- **Requests**: HTTP客户端

### 数据流程
1. 用户评分数据 → 标签偏好分析 → 理想形象生成
2. 用户输入 → 角色设定构建 → DeepSeek API调用 → AI回复生成

## 📊 API接口

### POST /api/fantasy-chat
生成AI回复

**请求体:**
```json
{
  "message": "用户消息",
  "character_traits": {
    "hair": "发色",
    "eye": "瞳色", 
    "glass": "配饰",
    "aura": "气质",
    "age": "年龄特征",
    "baseChar": "基础性格",
    "tone": "语气",
    "world": "世界观倾向"
  }
}
```

**响应:**
```json
{
  "success": true,
  "reply": "AI回复内容"
}
```

### GET /api/fantasy-chat/health
健康检查接口

## 🎨 界面设计

### 设计理念
- **粉色主题**: 符合乙女游戏的美学风格
- **卡片布局**: 清晰的信息层次
- **响应式设计**: 支持移动端访问
- **动画效果**: 平滑的交互体验

### 主要页面
- **偏好报告页面**: 数据分析和图表展示
- **幻想时间页面**: 理想形象展示和AI对话

## 🔧 配置说明

### 环境变量
- `DEEPSEEK_API_KEY`: DeepSeek API密钥（必需）

### 依赖包
- `Flask==2.3.3`: Web框架
- `Flask-CORS==4.0.0`: 跨域支持
- `Flask-SQLAlchemy==3.0.5`: ORM框架
- `requests==2.31.0`: HTTP客户端
- `python-dotenv==1.0.0`: 环境变量管理

## 🧪 测试

运行测试脚本验证功能：
```bash
python test_fantasy_chat.py
```

## 📝 注意事项

1. **API限制**: DeepSeek API有调用频率和额度限制
2. **数据隐私**: 对话内容会记录到控制台，生产环境建议保存到数据库
3. **性能优化**: 建议对API调用进行缓存和限流
4. **错误处理**: 网络异常时会有友好的错误提示

## 🔮 未来扩展

- [ ] 支持多角色切换
- [ ] 添加语音对话功能
- [ ] 实现对话历史保存
- [ ] 增加更多个性化选项
- [ ] 支持图片生成功能

## 📞 技术支持

如有问题，请检查：
1. API密钥是否正确配置
2. 网络连接是否正常
3. 依赖包是否完整安装
4. 服务端口是否被占用

---

**享受你的幻想时间！** ✨ 